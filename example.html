<!DOCTYPE html>
<html lang="en">
  <head>
    <title>GeolocationThrottle Example</title>
  </head>
  <body>
    <h1>GeolocationThrottle Example</h1>
    <p>
      This example will print the lat/lng of the current location, at most once every 5 seconds.

      <br>
      <br>
      <button id="start">Start (watchPosition)</button>
      <button id="stop">Stop (clearWatch)</button>
    </p>
    <div id="error"></div>
    <ul id="positions"></ul>
  </body>
  <script src="geolocation-throttle-es6.js"></script>
  <script>
    const startButton = document.getElementById("start");
    const stopButton = document.getElementById("stop");
    const error = document.getElementById("error");
    const positions = document.getElementById("positions");

    if (window.navigator && window.navigator.geolocation) {
      let watchId = null;

      startButton.onclick = () => {
        const startTime = new Date();
        watchId = GeolocationThrottle.watchPosition(position => {
            const timeElapsed = (new Date() - startTime) / 1000.0;

            const locationRecord = document.createElement("li");
            locationRecord.innerHTML = `<li>${timeElapsed} seconds: ${position.coords.latitude}, ${position.coords.longitude}</li>`;
            positions.appendChild(locationRecord);
            locationRecord.scrollIntoView({ behavior: "smooth" });
          },
          () => error.textContent = "Could not get position. Have you allowed your browser and this website to check it?",
          {
            throttleTime: 0 // here we specify that we want a geolocation callback at most once every 5 seconds
          });
      };

      stopButton.onclick = () => GeolocationThrottle.clearWatch(watchId);
    } else {
      error.textContent = "Could not get position. Have you allowed your browser and this website to check it?";
    }
  </script>
</html>
